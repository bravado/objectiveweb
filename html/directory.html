<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>ObjectiveWeb Directory Module</title>
</head>
<body>


<script id="directoryEntryTemplate" type="text/html">
    
    <p><a href="#" data-bind="click: function() { $item.edit($data.oid) }, text:uid"></a></p>

</script>


<div id="directoryMain" data-bind-ui="visible: currentView() == 'list'">

    <div data-bind-ui="template: { name: 'directoryEntryTemplate',
     foreach: entries,
     templateOptions: {
      edit: editEntry,
      oid: currentOID
     }
    }">
        
    </div>
</div>




<div id="directoryEditor"  data-bind-ui="visible: currentView() == 'editor'">
    <fieldset>
        <legend data-bind="text: uid" ></legend>

        <label>Nome: <input data-bind="value: cn" type="text"/></label>
    </fieldset>


    <button data-bind="click: postData" >Atualizar</button>
    <button data-bind-ui="click: function() { uiModel.currentView('list')}">Back</button>
</div>


<script type="text/javascript">

    var uiModel = {
        title: ko.observable(),
        entries: ko.observableArray(),
        currentView: ko.observable('list'),
        currentOID: null,
        editEntry: function(uid) {

            console.log('edit');
            $.getJSON('directory.php?oid=' + uid, function(data) {

                viewModel.uid(data.uid);
                viewModel.cn(data.cn);
                uiModel.currentView('editor');
                uiModel.currentOID = uid;
            });


        }


    };

    var viewModel = {

        uid: ko.observable(),
        cn: ko.observable(),


        postData: function() {

            var data = ko.toJSON(viewModel);

            $.post('/objectiveweb/directory.php?oid=' + uiModel.currentOID, data);
        }

    };


    ko.applyBindings(uiModel, 'ui');
    ko.applyBindings(viewModel);


    jQuery(function($) {
        $.getJSON('/objectiveweb/directory.php', function(data) {

            uiModel.entries(data);
    })
    });


</script>


</body>
</html>